<!doctype html>
<html>

<head>
	<title>5e Mass Combat Roller</title>
	<link defer rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css' integrity='sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO' crossorigin='anonymous'>
	<link rel='stylesheet' href='index.css'>
	<meta name='viewport' content='width=device-width, initial-scale=1, shrink-to-fit=no'>
	<meta charset='utf-8'>
</head>

<body>
	<main class='wrapper'>
		<section class='section properties'>
			<section class='container-fluid' style='margin-top: 5px' data-bind='with: selectedAttacker'>
				<div class='form-row'>
					<div class='form-group col-2'>
						<label>Name</label>
						<input type='text' class='form-control' onfocus='this.select()' data-bind='textInput: name'>
					</div>
					<div class='form-group col-2'>
						<label>Count</label>
						<input type='number' class='form-control' onfocus='this.select()' data-bind='value: count' min='1' max='100' step='1'>
					</div>
					<div class='form-group col-2'>
						<label>Advantage</label>
						<select class='custom-select form-control' data-bind='options: ["advantage", "normal", "disadvantage"], value: advantage'></select>
					</div>
					<div class='form-group col-2'>
						<label>Modifier</label>
						<input type='number' class='form-control' onfocus='this.select()' data-bind='value: attackModifier' min='0' max='30' step='1'>
					</div>
				</div>
				<div class='form-inline form-group' data-bind='with: damage'>
					<input type='number' class='form-control mr-2 small-number' onfocus='this.select()' data-bind='value: count'>
					<label class='sm-1'>d</label>
					<input type='number' class='form-control mx-2 small-number' onfocus='this.select()' data-bind='value: sides'>
					<label class='sm-1'>+</label>
					<input type='number' class='form-control mx-2 small-number' onfocus='this.select()' data-bind='value: modifier'>
					<select class='custom-select fixed-width-select form-control col-sm-2' data-bind='options: ["acid", "bludgeoning", "cold", "fire", "force", "lightning", "necrotic", "piercing", "poison", "psychic", "radiant", "slashing", "thunder"], value: type'></select>
				</div>
				<div class='form-inline form-group'>
					<button class='btn mr-2' data-bind='css: { "btn-primary": !!onHitEffect(), "btn-secondary": !onHitEffect() }, click: toggleOnHitEffect'>On Hit</button>
					<!-- ko with: onHitEffect -->
					<button class='btn mr-2' data-bind='css: { "btn-primary": !!condition(), "btn-secondary": !condition() }, click: toggleCondition'>Effect</button>
					<section data-bind='if: condition'>
						<select class='custom-select fixed-width-select form-control col-sm-2 mr-2' data-bind='options: ["grappled", "prone", "restrained"], value: condition'></select>
					</section>
					<button class='btn mr-2' data-bind='css: { "btn-primary": !!save(), "btn-secondary": !save() }, click: toggleSave'>Save</button>
					<!-- ko with: save -->
					<select class='custom-select fixed-width-select form-control col-sm-2 mr-2' data-bind='options: ["strength", "dexterity", "constitution", "intelligence", "wisdom", "charisma"], value: attribute'></select>
					<input type='number' class='form-control mr-2 small-number' onfocus='this.select()' data-bind='value: dc'>
					<!-- /ko -->
					<button class='btn mr-2' data-bind='css: { "btn-primary": !!damage(), "btn-secondary": !damage() }, click: toggleDamage'>Damage</button>
					<div class='form-inline form-group' data-bind='with: damage'>
						<input type='number' class='form-control mr-2 small-number' onfocus='this.select()' data-bind='value: count'>
						<label class='sm-1'>d</label>
						<input type='number' class='form-control mx-2 small-number' onfocus='this.select()' data-bind='value: sides'>
						<label class='sm-1'>+</label>
						<input type='number' class='form-control mx-2 small-number' onfocus='this.select()' data-bind='value: modifier'>
						<select class='custom-select fixed-width-select form-control col-sm-2' style='flex:auto' data-bind='options: ["acid", "bludgeoning", "cold", "fire", "force", "lightning", "necrotic", "piercing", "poison", "psychic", "radiant", "slashing", "thunder"], value: type'></select>
					</div>
					<!-- /ko -->
				</div>
			</section>
			<section class='container-fluid' data-bind='with: selectedDefender'>
				<div class='form-row'>
					<div class='form-group col-2'>
						<label>Name</label>
						<input type='text' class='form-control' onfocus='this.select()' data-bind='textInput: name'>
					</div>
					<div class='form-group col-2'>
						<label>AC</label>
						<input type='text' class='form-control' onfocus='this.select()' data-bind='value: attackDc'>
					</div>
					<div class='form-group col-2'>
						<label>Save Advantage</label>
						<select class='custom-select form-control' data-bind='options: ["advantage", "normal", "disadvantage"], value: saveAdvantage'></select>
					</div>
				</div>
				<div class='form-inline' data-bind='with: saveModifiers'>
					<div>
						<label>Strength</label>
						<input type='number' class='form-control save-modifier' onfocus='this.select()' data-bind='value: strength'>
					</div>
					<div>
						<label>Dexterity</label>
						<input type='number' class='form-control save-modifier' onfocus='this.select()' data-bind='value: dexterity'>
					</div>
					<div>
						<label>Constitution</label>
						<input type='number' class='form-control save-modifier' onfocus='this.select()' data-bind='value: constitution'>
					</div>
					<div>
						<label>Intelligence</label>
						<input type='number' class='form-control save-modifier' onfocus='this.select()' data-bind='value: intelligence'>
					</div>
					<div>
						<label>Wisdom</label>
						<input type='number' class='form-control save-modifier' onfocus='this.select()' data-bind='value: wisdom'>
					</div>
					<div>
						<label>Charisma</label>
						<input type='number' class='form-control save-modifier' onfocus='this.select()' data-bind='value: charisma'>
					</div>
				</div>
			</section>
		</section>
		<section class='section defenders'>
			<!-- ko foreach: defenders -->
			<div class='defender' data-bind='event: { dragover: $root.onDragOver, dragleave: $root.onDragLeave, drop: $root.onDropOnDefender }'>
				<div class='card-header defender-header'>
					<span class='hidden float-right' style='opacity: 0.5' data-bind='click: $root.onRemoveDefender, clickBubble: false'>
						<svg preserveAspectRatio='xMidYMid meet' width="40" height="40" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
							<path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/>
						</svg>
					</span>
					<h4 class='unselectable text-left' data-bind='text: name, click: $root.onSelectDefender'></h4>
				</div>
				<ul class='list' data-bind='foreach: attackers'>
					<li class='attacker' draggable='true' data-bind='event: { dragstart: $root.onDragStart }, uniqueId: true'>
						<span class='hidden float-right' style='opacity: 0.5' data-bind='click: $root.onRemoveAttacker, clickBubble: false'>
							<svg preserveAspectRatio='xMidYMid meet' width="30" height="30" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
								<path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/>
							</svg>
						</span>
						<h4 class='text-left' data-bind='text: name() + " (" + count() + ")", click: $root.onSelectAttacker, clickBubble: false'></h4>
					</li>
				</ul>
			</div>
			<!-- /ko -->
			<div class='newDefender' data-bind='click: onAddDefender'>
				<div class='icon'>
					<svg xmlns='http://www.w3.org/2000/svg' width='50' height='50' viewBox='0 0 24 24' style='fill: #bcbcbc;'>
						<path d='M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6 13h-5v5h-2v-5h-5v-2h5v-5h2v5h5v2z' />
					</svg>
				</div>
			</div>
		</section>
		<section class='section attackers' data-bind='event: { dragover: $root.onDragOver, dragleave: $root.onDragLeave, drop: $root.onDropOnAttackers }'>
			<ul class='list'>
				<!-- ko foreach: attackers -->
				<li class='attacker' draggable='true' data-bind='event: { dragstart: $root.onDragStart }, uniqueId: true'>
					<span class='hidden float-right' style='opacity: 0.5' data-bind='click: $root.onRemoveAttacker, clickBubble: false'>
						<svg preserveAspectRatio='xMidYMid meet' width="30" height="30" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg">
							<path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/>
						</svg>
					</span>
					<h4 class='text-left' data-bind='text: name() + " (" + count() + ")", click: $root.onSelectAttacker, clickBubble: true'></h4>
				</li>
				<!-- /ko -->
				<li class='newAttacker' data-bind='click: onAddAttacker'>
					<div class='icon'>
						<svg xmlns='http://www.w3.org/2000/svg' width='30' height='30' viewBox='0 0 24 24' style='fill: #b7b7b7;'>
							<path d='M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm6 13h-5v5h-2v-5h-5v-2h5v-5h2v5h5v2z' />
						</svg>
					</div>
				</li>
			</ul>
		</section>
		<section class='section roll unselectable' data-bind='click: onRoll'>Roll</section>
		<section class='section results' style='padding: 10px; grid-gap: 10px; display: grid' data-bind='foreach: results'>
			<div style='border-style: double'>
				<div style='padding: 5px'>
					<b data-bind='text: defender'></b> (crits: <span data-bind='text: results.hits.numCrits'></span>, hits: <span data-bind='text: results.hits.numHits'></span>, misses: <span data-bind='text: results.hits.numMisses'></span>)
				</div>
				<div style='padding: 5px'>
					<b>Damage: <span data-bind='text: results.damage.total'></span></b> <span data-bind='text: Array.from(results.damage.asMap.entries()).filter(x => x[1]).map(x => `${x[0]}: ${x[1]}`).join(", ")'></span>
				</div>
				<div data-bind='if: results.conditions.asArray.length' style='padding: 5px'>
					<b>Conditions: </b> <span data-bind='text: results.conditions.asArray.join(", ")'></span>
				</div>
			</div>
		</section>
	</div>
	<script type='text/javascript' data-main='./output/require-config.js' src='https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js'></script>
</body>

</html>
